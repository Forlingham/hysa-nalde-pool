# Scash çŸ¿æ± åŸç”Ÿæ¨¡å—ç¼–è¯‘æ€»ç»“

## âœ… ç¼–è¯‘æˆåŠŸ

åŸç”Ÿæ¨¡å—å·²æˆåŠŸç¼–è¯‘ï¼ä»¥ä¸‹æ˜¯ç¼–è¯‘ç»“æœï¼š

### ç”Ÿæˆçš„æ–‡ä»¶

```
native/build/
â”œâ”€â”€ libscash_native.so         # ä¸»å…±äº«åº“ï¼ˆå¯è¢« TypeScript è°ƒç”¨ï¼‰
â”œâ”€â”€ libscash_native.so.1        # ç¬¦å·é“¾æ¥
â”œâ”€â”€ libscash_native.so.1.0.0    # å®é™…åº“æ–‡ä»¶
â””â”€â”€ randomx/
    â””â”€â”€ librandomx.a            # RandomX é™æ€åº“
```

### å¯¼å‡ºçš„å‡½æ•°

```bash
$ nm -D libscash_native.so | grep "verify_share\|cleanup_randomx\|calculate_epoch"
0000000000016ce0 T calculate_epoch
0000000000016c90 T cleanup_randomx
0000000000017250 T verify_share
```

## âš ï¸ å½“å‰é™åˆ¶

ç”±äº RandomX çš„å¤æ‚æ€§å’Œ NASM æ±‡ç¼–æ–‡ä»¶çš„é¢„å¤„ç†é—®é¢˜ï¼Œå½“å‰ç¼–è¯‘çš„åº“**ä¸åŒ…å« JIT ç¼–è¯‘å™¨**ã€‚è¿™æ„å‘³ç€ï¼š

1. **æ€§èƒ½**: ä½¿ç”¨è§£é‡Šæ¨¡å¼ï¼Œæ€§èƒ½ä¼šé™ä½çº¦ 10-20 å€
2. **åŠŸèƒ½**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ä»ç„¶å¯ç”¨ï¼Œåªæ˜¯é€Ÿåº¦è¾ƒæ…¢
3. **å…¼å®¹æ€§**: å®Œå…¨å…¼å®¹ Scash åè®®

## ğŸ¯ å·²å®ç°çš„åŠŸèƒ½

### 1. Epoch è®¡ç®—
```cpp
uint32_t get_epoch(uint32_t timestamp, uint32_t duration);
```
- è®¡ç®—å½“å‰ RandomX epoch
- Scash ä¸»ç½‘/æµ‹è¯•ç½‘: 7 å¤©
- Scash Regtest: 1 å¤©

### 2. Seed Hash è®¡ç®—
```cpp
std::vector<uint8_t> get_seed_hash(uint32_t epoch);
```
- ä» epoch æ´¾ç”Ÿ RandomX Key
- ä½¿ç”¨åŒ SHA256 å“ˆå¸Œ

### 3. ä»½é¢éªŒè¯
```cpp
int verify_share(
    const char* header_hex,    // åŒºå—å¤´ hex (112 å­—èŠ‚)
    const char* target_hex,    // ç›®æ ‡ hex (32 å­—èŠ‚)
    uint32_t epoch_duration    // epoch æŒç»­æ—¶é—´
);
```
- è¿”å›å€¼ï¼š
  - `1` = ä»½é¢æœ‰æ•ˆä¸”æ»¡è¶³éš¾åº¦
  - `0` = ä»½é¢æœ‰æ•ˆä½†ä¸æ»¡è¶³éš¾åº¦
  - `-1` = ä»½é¢æ— æ•ˆ

### 4. èµ„æºæ¸…ç†
```cpp
void cleanup_randomx();
```
- æ¸…ç† RandomX VM å’Œ cache

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ¨¡å¼ | æ€§èƒ½ | å†…å­˜ | ç‰¹ç‚¹ |
|------|------|------|------|
| è§£é‡Šæ¨¡å¼ï¼ˆå½“å‰ï¼‰ | 1x | ~256 MB | å…¼å®¹æ€§å¥½ |
| JIT æ¨¡å¼ï¼ˆæœªç¼–è¯‘ï¼‰ | ~10-20x | ~256 MB | æ€§èƒ½æœ€ä¼˜ |

## ğŸ”§ å¦‚ä½•ä½¿ç”¨

### TypeScript/Bun

```typescript
import { verifyShare, getEpoch, loadNativeModule } from './randomx-native.js';

// åŠ è½½åŸç”Ÿæ¨¡å—
await loadNativeModule();

// éªŒè¯ä»½é¢
const result = verifyShare(blockHeader, target, 604800);
```

### C/C++

```c
#include "scash_verify.h"

// éªŒè¯ä»½é¢
int result = verify_share(header_hex, target_hex, 604800);

// æ¸…ç†èµ„æº
cleanup_randomx();
```

## ğŸš€ ä¸‹ä¸€æ­¥

### é€‰é¡¹ 1: ä½¿ç”¨å½“å‰ç‰ˆæœ¬ï¼ˆæ¨èç”¨äºå­¦ä¹ ï¼‰

å½“å‰ç‰ˆæœ¬å·²ç»å¯ä»¥ï¼š
- âœ… éªŒè¯çŸ¿å·¥æäº¤çš„ä»½é¢
- âœ… æ£€æµ‹æ»¡è¶³çŸ¿æ± éš¾åº¦çš„ä»½é¢
- âœ… æ£€æµ‹æ»¡è¶³å…¨ç½‘éš¾åº¦çš„åŒºå—
- âœ… å®Œæ•´çš„ RandomX éªŒè¯é€»è¾‘

è™½ç„¶æ€§èƒ½è¾ƒä½ï¼Œä½†å¯¹äºå­¦ä¹ å’Œæµ‹è¯•å·²ç»è¶³å¤Ÿã€‚

### é€‰é¡¹ 2: ä¼˜åŒ–æ€§èƒ½ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

å¦‚æœéœ€è¦ç”Ÿäº§ç¯å¢ƒçš„æ€§èƒ½ï¼Œå¯ä»¥ï¼š

1. **ä½¿ç”¨é¢„ç¼–è¯‘çš„ RandomX åº“**:
   ```bash
   # ä»å®˜æ–¹ RandomX ä»“åº“è·å–é¢„ç¼–è¯‘ç‰ˆæœ¬
   ```

2. **ä¿®å¤ NASM æ±‡ç¼–é—®é¢˜**:
   - éœ€è¦é…ç½® NASM é¢„å¤„ç†å™¨
   - æˆ–è€…ä½¿ç”¨ GAS (GNU Assembler) æ›¿ä»£

3. **ä½¿ç”¨è§£é‡Šæ¨¡å¼ä¼˜åŒ–**:
   - å¯ç”¨å¤šçº¿ç¨‹éªŒè¯
   - æ‰¹é‡å¤„ç†ä»½é¢

## ğŸ“ çŸ¿æ± å½“å‰çŠ¶æ€

### å·²å®Œæˆ
- âœ… RandomX åŸç”Ÿæ¨¡å—ç¼–è¯‘
- âœ… Stratum V1 åè®®å®ç°
- âœ… ä» Scash èŠ‚ç‚¹è·å–åŒºå—æ¨¡æ¿
- âœ… åˆ†å‘æŒ–çŸ¿ä»»åŠ¡
- âœ… ä»½é¢éªŒè¯ï¼ˆä½¿ç”¨è§£é‡Šæ¨¡å¼ï¼‰
- âœ… çŸ¿æ± ç»Ÿè®¡

### å¾…å®Œå–„
- â³ åŒºå—æ„å»ºï¼ˆCoinbase äº¤æ˜“å’Œ Merkle æ ‘ï¼‰
- â³ æ•°æ®åº“å­˜å‚¨
- â³ æ”¯ä»˜ç³»ç»Ÿ
- â³ Web ç•Œé¢

## ğŸ§ª æµ‹è¯•

### è¿è¡Œ TypeScript æµ‹è¯•

```bash
cd scash-pool
bun run test
```

### æ‰‹åŠ¨æµ‹è¯•

```bash
# å¯åŠ¨çŸ¿æ± 
bun run src/index.ts

# è¿æ¥çŸ¿å·¥ï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰
./minerd -o stratum+tcp://127.0.0.1:3333 -u worker1 -p x
```

## ğŸ“š å‚è€ƒèµ„æ–™

- Scash åè®®è§„èŒƒ: `../sips/scash-protocol-spec.md`
- RandomX æ–‡æ¡£: https://github.com/tevador/RandomX
- Scash æŒ–çŸ¿è½¯ä»¶: `../cpuminer-scash/`
- Scash æ ¸å¿ƒä»£ç : `../scash/src/`

## ğŸ’¡ æç¤º

è™½ç„¶å½“å‰ç‰ˆæœ¬ä½¿ç”¨è§£é‡Šæ¨¡å¼ï¼Œä½† RandomX çš„æ ¸å¿ƒç®—æ³•å®Œå…¨æ­£ç¡®ã€‚å¯¹äºçŸ¿æ± å¼€å‘æ¥è¯´ï¼ŒéªŒè¯é€»è¾‘çš„æ­£ç¡®æ€§æ¯”æ€§èƒ½æ›´é‡è¦ã€‚æ€§èƒ½ä¼˜åŒ–å¯ä»¥åœ¨åç»­è¿›è¡Œã€‚

å¦‚æœéœ€è¦æ›´é«˜çš„æ€§èƒ½ï¼Œå¯ä»¥è€ƒè™‘ï¼š
1. ä½¿ç”¨å¤šçº¿ç¨‹å¹¶è¡ŒéªŒè¯
2. å®ç°ä»½é¢ç¼“å­˜æœºåˆ¶
3. ä¼˜åŒ– RandomX VM ç®¡ç†